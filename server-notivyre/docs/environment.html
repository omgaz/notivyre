<!DOCTYPE html>  <html> <head>   <title>environment.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="app.html">                 app.coffee               </a>                                           <a class="source" href="environment.html">                 environment.coffee               </a>                                           <a class="source" href="redis.html">                 redis.coffee               </a>                                           <a class="source" href="routes.html">                 routes.coffee               </a>                                           <a class="source" href="sockets.html">                 sockets.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               environment.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h1>Environment</h1>

<p>This is the configuration of our <code>ExpressJS</code> server.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h4>Constant Declaration</h4>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">SESSION_SECRET = </span><span class="s">&quot;vyingForVyre&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h3>Configure the <strong>NotiVYRE</strong> server</h3>

<p>When using methods such as PUT with a form, we can utilize a hidden input
named <strong><em>_method</em></strong>, which can be used to alter the HTTP method. To do so
we first need the <strong><em>methodOverride</em></strong> middleware, which should be placed below
<strong><em>bodyParser</em></strong> so that it can utilize itâ€™s <strong><em>req.body</em></strong> containing the form values.</p>

<p>The <strong><em>bodyParser</em></strong> middleware  will parse json request bodies (as well as others),
and place the result in <strong><em>req.body</em></strong>.</p>

<p>We'll be using the templating language <strong><em>EJS</em></strong> to render our pages.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">module.exports = </span><span class="nf">(notiServer, express, io) -&gt;</span>
	
	<span class="nx">notiServer</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span> <span class="nf">() -&gt;</span>
		
		<span class="nx">notiServer</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">favicon</span><span class="p">(</span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">__dirname</span><span class="si">}</span><span class="s">/../client-notivyre/img/favicon.ico&quot;</span><span class="p">)</span> <span class="p">)</span>
		<span class="nx">notiServer</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">bodyParser</span><span class="p">())</span>
		<span class="nx">notiServer</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">methodOverride</span><span class="p">())</span>
		
		<span class="nx">notiServer</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s">&#39;views&#39;</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">__dirname</span><span class="si">}</span><span class="s">/views&quot;</span><span class="p">)</span>
		<span class="nx">notiServer</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s">&#39;view engine&#39;</span><span class="p">,</span> <span class="s">&#39;ejs&#39;</span><span class="p">)</span>
		<span class="nx">notiServer</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s">&#39;view options&#39;</span><span class="p">,</span>
			<span class="nv">layout: </span><span class="kc">true</span>
		<span class="p">)</span>
		
		<span class="nx">notiServer</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">cookieParser</span><span class="p">())</span>
		<span class="nx">notiServer</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">static</span><span class="p">(</span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">__dirname</span><span class="si">}</span><span class="s">/../client-notivyre&quot;</span><span class="p">)</span> <span class="p">)</span>
		<span class="nx">notiServer</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">session</span><span class="p">({</span> <span class="nv">secret: </span><span class="nx">SESSION_SECRET</span><span class="p">,</span> <span class="nv">store: </span><span class="nx">notiServer</span><span class="p">.</span><span class="nx">sessionStore</span> <span class="p">}))</span>
		<span class="nx">notiServer</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">notiServer</span><span class="p">.</span><span class="nx">router</span><span class="p">)</span>
	<span class="p">)</span>
	</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h4>Development environment setup</h4>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">notiServer</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="s">&#39;development&#39;</span><span class="p">,</span> <span class="nf">() -&gt;</span>
		<span class="nx">notiServer</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">logger</span><span class="p">())</span>
		<span class="nx">notiServer</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span> <span class="nx">express</span><span class="p">.</span><span class="nx">errorHandler</span><span class="p">(</span> <span class="nv">dumpExceptions: </span><span class="kc">true</span><span class="p">,</span> <span class="nv">showStack: </span><span class="kc">true</span> <span class="p">)</span> <span class="p">)</span>
		
		<span class="nx">io</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s">&#39;transports&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;websocket&#39;</span><span class="p">,</span> <span class="s">&#39;xhr-polling&#39;</span><span class="p">])</span>
		<span class="nx">io</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s">&#39;log level&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
	<span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h4>Production environment setup</h4>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">notiServer</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="s">&#39;production&#39;</span><span class="p">,</span> <span class="nf">() -&gt;</span>
		<span class="nx">notiServer</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">gzippo</span><span class="p">.</span><span class="nx">compress</span><span class="p">())</span>
		<span class="nx">notiServer</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">errorHandler</span><span class="p">())</span>
		
		<span class="nx">io</span><span class="p">.</span><span class="nx">enable</span><span class="p">(</span><span class="s">&#39;browser client minification&#39;</span><span class="p">)</span>
		<span class="nx">io</span><span class="p">.</span><span class="nx">enable</span><span class="p">(</span><span class="s">&#39;browser client etag&#39;</span><span class="p">)</span>
		<span class="nx">io</span><span class="p">.</span><span class="nx">enable</span><span class="p">(</span><span class="s">&#39;browser client gzip&#39;</span><span class="p">)</span>
		<span class="nx">io</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s">&#39;log level&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
	<span class="p">)</span>
		
	
	<span class="k">return</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 